<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<link rel="stylesheet" href="style.css" type="text/css">
<meta content="text/html; charset=iso-8859-1" http-equiv="Content-Type">
<link rel="Start" href="index.html">
<link rel="previous" href="As_action.html">
<link rel="Up" href="index.html">
<link title="Index of types" rel=Appendix href="index_types.html">
<link title="Index of values" rel=Appendix href="index_values.html">
<link title="Index of modules" rel=Appendix href="index_modules.html">
<link title="As_resolver" rel="Chapter" href="As_resolver.html">
<link title="As_build_env" rel="Chapter" href="As_build_env.html">
<link title="As_action" rel="Chapter" href="As_action.html">
<link title="Assemblage" rel="Chapter" href="Assemblage.html"><link title="Features" rel="Section" href="#features">
<link title="Flags" rel="Section" href="#flags">
<link title="Project" rel="Section" href="#project">
<link title="Tools" rel="Section" href="#tools">
<link title="The Project API" rel="Subsection" href="#2_TheProjectAPI">
<title>Assemblage</title>
</head>
<body>
<div class="navbar"><a class="pre" href="As_action.html" title="As_action">Previous</a>
&nbsp;<a class="up" href="index.html" title="Index">Up</a>
&nbsp;</div>
<h1>Module <a href="type_Assemblage.html">Assemblage</a></h1>

<pre><span class="keyword">module</span> Assemblage: <code class="code"><span class="keyword">sig</span></code> <a href="Assemblage.html">..</a> <code class="code"><span class="keyword">end</span></code></pre><div class="info module top">
The Assemblage Library.
<p>

    <code class="code"><span class="constructor">Assemblage</span></code> provides a simple embedded domain specific language
    to describe <code class="code"><span class="constructor">OCaml</span></code> <a href="Assemblage.html#project">projects</a>. It also provides simple
    <a href="Assemblage.html#tools">tools</a> to configure, manage, install and use OCaml
    projects.
<p>

    Describing a project eventually leads to describe its build
    artifacts. The exact mapping betweem project elements and those
    build artifacts depends on the presence or absence of
    <a href="Assemblage.html#features">features</a>. Examples of such features are weather to
    compile and run the tests (user-defined feature), the presence of
    the native compiler (system-dependant feature), compiling a
    library using <code class="code">async</code> or <code class="code">lwt</code> as a backend (environment-dependant
    feature), ...
<p>

    Finally, generating build artifacts means refining the project
    description into concrete <a href="Assemblage.html#flags">command-line arguments</a> to pass
    to the different compilers (<code class="code">ocamlc</code>, <code class="code">ocamlopt</code>) on the different
    compilation and linking phases.
<p>

    <em>Release %%VERSION%% - %%AUTHOR%% </em><br>
</div>
<hr width="100%">
<br>
<h1 id="features">Features</h1><br>
<br>
Typical OCaml project might have multiple features, which modifies
    the list of generated artifacts. An example is a project which
    depends on either <code class="code">lwt</code> or <code class="code">async</code>, and which choose to compile
    the relevant libraries only if one of the other is installed on
    the system. Other typical feature might depend on the machine the
    project is running on, for instance the fact that the native
    toolchain is available or not.<br>

<pre><span class="keyword">module</span> <a href="Assemblage.Features.html">Features</a>: <code class="code"><span class="keyword">sig</span></code> <a href="Assemblage.Features.html">..</a> <code class="code"><span class="keyword">end</span></code></pre><br>
<h1 id="flags">Flags</h1><br>
<br>
The various compilation options that are set for a project
    eventually reduce to tweaking the simple command-line arguments to
    the compiler. We distinguish three different phases, where the
    command-line can be changed: the pre-processing step, the separate
    compilation of module implementations and signatures and the
    linking of such compilation units to produce a library or a
    binary. These three phases come in two modes: bytecode compilation
    and native-code compilation.<br>

<pre><span class="keyword">module</span> <a href="Assemblage.Flags.html">Flags</a>: <code class="code"><span class="keyword">sig</span></code> <a href="Assemblage.Flags.html">..</a> <code class="code"><span class="keyword">end</span></code></pre><br>
<h1 id="project">Project</h1><br>
<br>
A typical project contains the descriptions of multiple
    components, such as libraries, binaries, tests, ... forming a
    complex DAG of inter-related component descriptions.<br>

<pre><span id="TYPEt"><span class="keyword">type</span> <code class="type"></code>t</span> </pre>
<div class="info ">
The type for OCaml projects descriptions.<br>
</div>


<pre><span id="TYPEcu"><span class="keyword">type</span> <code class="type"></code>cu</span> </pre>
<div class="info ">
The type for compilation unit descriptions.<br>
</div>


<pre><span id="TYPElib"><span class="keyword">type</span> <code class="type"></code>lib</span> </pre>
<div class="info ">
The type for library descriptions.<br>
</div>


<pre><span id="TYPEbin"><span class="keyword">type</span> <code class="type"></code>bin</span> </pre>
<div class="info ">
The type for binary executable descriptions.<br>
</div>


<pre><span id="TYPEtest"><span class="keyword">type</span> <code class="type"></code>test</span> </pre>
<div class="info ">
The type for test descriptions.<br>
</div>


<pre><span id="TYPEjs"><span class="keyword">type</span> <code class="type"></code>js</span> </pre>
<div class="info ">
The type for <code class="code">js_of_ocaml</code> artifact descriptions.<br>
</div>


<pre><span id="TYPEc"><span class="keyword">type</span> <code class="type"></code>c</span> </pre>
<div class="info ">
The type for C source file descriptions.<br>
</div>


<pre><span id="TYPEgen"><span class="keyword">type</span> <code class="type"></code>gen</span> </pre>
<div class="info ">
The type for generated OCaml source code.<br>
</div>


<pre><span id="TYPEcomponent"><span class="keyword">type</span> <code class="type"></code>component</span> = <code class="type">[ `Bin of <a href="Assemblage.html#TYPEbin">bin</a><br>       | `C of <a href="Assemblage.html#TYPEc">c</a><br>       | `CU of <a href="Assemblage.html#TYPEcu">cu</a><br>       | `Gen of <a href="Assemblage.html#TYPEgen">gen</a><br>       | `JS of <a href="Assemblage.html#TYPEjs">js</a><br>       | `Lib of <a href="Assemblage.html#TYPElib">lib</a><br>       | `Pkg of string<br>       | `Pkg_pp of string<br>       | `Pp of <a href="Assemblage.html#TYPElib">lib</a><br>       | `Test of <a href="Assemblage.html#TYPEtest">test</a> ]</code> </pre>
<div class="info ">
The type for all the possible component descriptions. A <code class="code"><span class="keywordsign">`</span><span class="constructor">CU</span> cu</code>
    is a local compilation unit, <code class="code"><span class="keywordsign">`</span><span class="constructor">Lib</span> l</code> is a local library, <code class="code"><span class="keywordsign">`</span><span class="constructor">Pp</span> p</code>
    is a local pre-processors and <code class="code"><span class="keywordsign">`</span><span class="constructor">Bin</span></code> is local biny.
<p>

    <code class="code"><span class="keywordsign">`</span><span class="constructor">Pkg</span> p</code> is a globally installed packages and <code class="code"><span class="keywordsign">`</span><span class="constructor">Pkg_pp</span></code> is a
    globally installed pre-processor packages, both usually managed by
    <i>ocamlfind</i>.<br>
</div>

<br>
<h2 id="2_TheProjectAPI">The Project API</h2><br>

<pre><span id="VALcu"><span class="keyword">val</span> cu</span> : <code class="type">?dir:string -><br>       string -> <a href="Assemblage.html#TYPEcomponent">component</a> list -> [> `CU of <a href="Assemblage.html#TYPEcu">cu</a> ]</code></pre><div class="info ">
<code class="code">cu name ~dir deps</code> is the compilation unit located in the
    directory <code class="code">dir</code> with dependencies <code class="code">deps</code> and the cname <code class="code">name</code>. The
    name is the same as the filename, without its extension.<br>
</div>

<pre><span id="VALocamldep"><span class="keyword">val</span> ocamldep</span> : <code class="type">dir:string -><br>       ?flags:<a href="Assemblage.Flags.html#TYPEt">Flags.t</a> -><br>       (string -> <a href="Assemblage.html#TYPEcomponent">component</a> list) -> [> `CU of <a href="Assemblage.html#TYPEcu">cu</a> ] list</code></pre><div class="info ">
<code class="code">ocamldep ~dir deps</code> is the list of compilation units in the given
    directory, obtained by running <code class="code">ocamldep</code> with the given flags and
    dependencies.<br>
</div>

<pre><span id="VALgenerated"><span class="keyword">val</span> generated</span> : <code class="type">?action:(<a href="As_resolver.html#TYPEt">As_resolver.t</a> -> <a href="As_action.html#TYPEt">As_action.t</a>) -><br>       string -><br>       <a href="Assemblage.html#TYPEcomponent">component</a> list -><br>       [ `C | `ML | `MLI ] list -> [> `Gen of <a href="Assemblage.html#TYPEgen">gen</a> ]</code></pre><div class="info ">
Generated OCaml source file(s). The custom action get the name of
    the build dir as argument.<br>
</div>

<pre><span id="VALc"><span class="keyword">val</span> c</span> : <code class="type">?dir:string -><br>       ?link_flags:string list -><br>       string -> <a href="Assemblage.html#TYPEcomponent">component</a> list -> string list -> [> `C of <a href="Assemblage.html#TYPEc">c</a> ]</code></pre><div class="info ">
<code class="code">c name deps libs</code> is the C file <code class="code">name.c</code>, which need the C
    libraries <code class="code">libs</code> to be compiled -- and it has the dependencies
    <code class="code">deps</code>.<br>
</div>

<pre><span id="VALcstubs"><span class="keyword">val</span> cstubs</span> : <code class="type">?dir:string -><br>       ?available:<a href="Assemblage.Features.html#TYPEt">Features.t</a> -><br>       ?headers:string list -><br>       ?cflags:string list -><br>       ?clibs:string list -><br>       string -> <a href="Assemblage.html#TYPEcomponent">component</a> list -> [> `Lib of <a href="Assemblage.html#TYPElib">lib</a> ]</code></pre><div class="info ">
<code class="code">stubs name deps</code> is the C stub generations, using Ctypes, of the
    compilation unit <code class="code">name</code>.<br>
</div>

<pre><span id="VALlib"><span class="keyword">val</span> lib</span> : <code class="type">?available:<a href="Assemblage.Features.html#TYPEt">Features.t</a> -><br>       ?flags:<a href="Assemblage.Flags.html#TYPEt">Flags.t</a> -><br>       ?pack:bool -><br>       ?deps:(string -> <a href="Assemblage.html#TYPEcomponent">component</a> list) -><br>       ?c:[ `C of <a href="Assemblage.html#TYPEc">c</a> ] list -><br>       string -> [ `CU of <a href="Assemblage.html#TYPEcu">cu</a> ] list -> [> `Lib of <a href="Assemblage.html#TYPElib">lib</a> ]</code></pre><div class="info ">
<code class="code">lib name units</code> is the library <code class="code">name</code> composed by the compilation
    units <code class="code">cus</code>. If <code class="code">lib</code> is set, use <code class="code">ocamldep</code> to approximate the
    compilation units and their dependecies in the given directory.<br>
</div>

<pre><span id="VALbin"><span class="keyword">val</span> bin</span> : <code class="type">?byte_only:bool -><br>       ?link_all:bool -><br>       ?install:bool -><br>       ?deps:(string -> <a href="Assemblage.html#TYPEcomponent">component</a> list) -><br>       string -> [ `CU of <a href="Assemblage.html#TYPEcu">cu</a> ] list -> [> `Bin of <a href="Assemblage.html#TYPEbin">bin</a> ]</code></pre><div class="info ">
<code class="code">bin name units</code> is the binary <code class="code">name</code> obtained by compiling
    the compilation units <code class="code">units</code>, with the dependencies <code class="code">deps</code>. By
    default, the source files are located into <i>bin/</i> (this is
    controled by the value of <code class="code">dir</code>).<br>
</div>

<pre><span id="VALjs"><span class="keyword">val</span> js</span> : <code class="type">[ `Bin of <a href="Assemblage.html#TYPEbin">bin</a> ] -> string list -> [> `JS of <a href="Assemblage.html#TYPEjs">js</a> ]</code></pre><div class="info ">
<code class="code">js bin args</code> is the decription of a javascript artefact generated
    by <code class="code">js_of_ocaml</code>.<br>
</div>

<pre><span id="VALpkg"><span class="keyword">val</span> pkg</span> : <code class="type">string -> [> `Pkg of string ]</code></pre><div class="info ">
An external package.<br>
</div>

<pre><span id="VALpkg_pp"><span class="keyword">val</span> pkg_pp</span> : <code class="type">string -> [> `Pkg_pp of string ]</code></pre><div class="info ">
An external pre-processor.<br>
</div>

<pre><span id="TYPEtest_command"><span class="keyword">type</span> <code class="type"></code>test_command</span> </pre>
<div class="info ">
The type for test commands.<br>
</div>


<pre><span id="TYPEtest_args"><span class="keyword">type</span> <code class="type"></code>test_args</span> = <code class="type">(<a href="Assemblage.html#TYPEcomponent">component</a> -> string) -> string list</code> </pre>
<div class="info ">
The type for command-line arguments when calling tests of executable.<br>
</div>


<pre><span id="VALtest_bin"><span class="keyword">val</span> test_bin</span> : <code class="type">[ `Bin of <a href="Assemblage.html#TYPEbin">bin</a> ] -><br>       ?args:<a href="Assemblage.html#TYPEtest_args">test_args</a> -> unit -> <a href="Assemblage.html#TYPEtest_command">test_command</a></code></pre><div class="info ">
A test which runs a binary built in the project.<br>
</div>

<pre><span id="VALtest_shell"><span class="keyword">val</span> test_shell</span> : <code class="type">('a, unit, string, <a href="Assemblage.html#TYPEtest_command">test_command</a>) Pervasives.format4 -> 'a</code></pre><div class="info ">
A test which runs an arbitrary shell command.<br>
</div>

<pre><span id="VALtest"><span class="keyword">val</span> test</span> : <code class="type">?dir:string -><br>       string -><br>       <a href="Assemblage.html#TYPEcomponent">component</a> list -><br>       <a href="Assemblage.html#TYPEtest_command">test_command</a> list -> [> `Test of <a href="Assemblage.html#TYPEtest">test</a> ]</code></pre><div class="info ">
Description of a test.<br>
</div>

<pre><span id="VALcreate"><span class="keyword">val</span> create</span> : <code class="type">?flags:<a href="Assemblage.Flags.html#TYPEt">Flags.t</a> -><br>       ?doc_css:string -><br>       ?doc_intro:string -><br>       ?doc_dir:string -><br>       ?doc_public:string list -><br>       ?version:string -> string -> <a href="Assemblage.html#TYPEcomponent">component</a> list -> unit</code></pre><div class="info ">
<code class="code">create name deps</code> registers the project named <code class="code">name</code>, defining
    the libraries, binaries and tests defined by the transitive
    closure of objects in <code class="code">deps</code>.<br>
</div>
<br>
<h1 id="tools">Tools</h1><br>

<pre><span id="TYPEtool"><span class="keyword">type</span> <code class="type"></code>tool</span> = <code class="type"><a href="Assemblage.html#TYPEt">t</a> -> <a href="As_build_env.html#TYPEt">As_build_env.t</a> -> unit</code> </pre>
<div class="info ">
The signature of tools.<br>
</div>


<pre><span id="VALprocess"><span class="keyword">val</span> process</span> : <code class="type">?file:string -> string -> <a href="Assemblage.html#TYPEtool">tool</a> -> unit</code></pre><div class="info ">
<code class="code">process ~file name fn</code> reads and processes the OCaml <code class="code">file</code> in a
    top-level environment (the default is <code class="code">assemble.ml</code>), for the
    project called <code class="code">name</code>, and apply <code class="code">fn</code> to the projects registered
    as side-effects.<br>
</div>

<pre><span id="VALconfigure"><span class="keyword">val</span> configure</span> : <code class="type">[ `Make ] -> <a href="Assemblage.html#TYPEtool">tool</a></code></pre><div class="info ">
Configure the project by generating the build, META and .install
    files, using the given build system backend (currently, only GNU
    make is supported).<br>
</div>

<pre><span id="VALdescribe"><span class="keyword">val</span> describe</span> : <code class="type"><a href="Assemblage.html#TYPEtool">tool</a></code></pre><div class="info ">
Describe the project to stdout.<br>
</div>
</body></html>